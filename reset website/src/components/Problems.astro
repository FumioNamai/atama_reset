---
import MoreButton from "./MoreButton.astro";

const problems = [
  "頭痛、頭が重い",
  "首や肩のコリ",
  "疲れ目、ドライアイ",
  "眠りが浅い",
  "すぐに疲れる",
  "疲れが取れない",
  "やる気が出ない",
  "うっかりミスが多い",
  "集中力・記憶力が低下した",
  "ストレスが多い",
  "イライラする",
  "手足が冷える",
  "食欲不振",
];
---

<section>
  <div class="grid-container">
  <div class="problems">
    <h2>こんなお悩みございませんか？</h2>
    <div class="wrapper">
      <ul>
        {
          problems.map((problem) => (
            <li class="list">
              <img
                src="/checked.svg"
                alt="チェック"
                width="14px"
                height="15px"
              />
              {problem}
            </li>
          ))
        }
      </ul>
      <div class="problems-image"></div>
    </div>
  </div>

  <div class="cause">
    <p class="text-1 fadeinText">「眠い」「疲れた」「飽きた」</p>
    <p class="text-2 fadeinText">それは<span class="bold large">『 脳疲労 』</span>のサイン</p>
    <div class="cause-image yawning"></div>
    <p class="text-3 fadeinText">脳の疲労が脳を「酸化」させ</p>
    <div class="icon fadeinText"></div>
    <p class="text-4 fadeinText">脳が誤作動を起こし</p>
    <div class="icon fadeinText"></div>
    <p class="text-5 fadeinText">疲れていない体が疲労感を感じる</p>
    <p class="text-6 fadeinText">自律神経の乱れを引き起こし<br>体のあらゆる部分に不調が出ます</p>
    <div class="fadeinText">
    <MoreButton
    href = "/brain_fatigue",
    label = "脳疲労とは..."
    width = "127px"
    marginInline = "auto"
    /></div>
  </div>

  <p class="otherwise fadeinText">もしくは･･･</p>

  <div class="cause">
    <p class="text-1 fadeinText">その不調<span class="bold">『 首 』</span>が原因かも？</p>
    <div class="cause-image stiff_neck"></div>
    <p class="text-3 fadeinText bold">首の後ろには<br>” 副交感神経センター ” があり</p>
    <p class="text-4 fadeinText">首に不具合がおこると</p>
    <div class="icon fadeinText"></div>
    <p class="text-5 fadeinText">副交感神経の働きが阻害され<br>自律神経が乱れ</p>
    <div class="icon fadeinText"></div>
    <p class="text-6 fadeinText">全身にさまざまな不調を誘発</p>
    <p class="text-7 fadeinText">「ストレスが原因」とされてきた症状も、<br>実は首のこりが原因であることが多いと判ってきました。</p>
    <p class="text-8 fadeinText highlight">原因不明の体の不調のほとんどが<br>自律神経の乱れによるものです</p>
  </div>

  <div class="suggestion">
    <div class="suggestion-image"></div>
    <div class="text-wrapper">
      <p class="primary">
        疲れた頭や体を<br />究極の癒しで<br /> ” reset ” しませんか
      </p>
    </div>
  </div>
  </div>

</section>

<style>
  section {
    margin-bottom: 80px;
  }
  .problems {
    display: flex;
    justify-content: center;
    flex-direction: column;
    gap: 2.4rem;
    max-width: 512px;
    overflow: hidden;
    padding-block: 24px;
    margin: 0 auto;
  }
  h2 {
    font-weight: normal;
    text-align: center;
  }
  p {
    padding-block: 1.6rem;
  }
  .wrapper {
    position: relative;
  }

  .problems-image {
    position: absolute;
    z-index: -10;
    /* top: 10%; */
    top: 0%;
    left: 40%;
    width: 100%;
    /* height: 80%; */
    height: 100%;
    background-position: top;
    background-size: cover;
    background-repeat: no-repeat;
    background-image: url(../assets/problem.webp);
    /* border-radius: 16px 0 0 16px; */
    filter: blur(1px);
    opacity: 0;
    transition: 1s .5s;
  }

  ul {
    padding-left: 2.4rem;
  }

  li {
    opacity: 0;
    font-size: 1.6rem;
    line-height: 200%;
    list-style: none;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  li > img {
    padding-top: 4px;
  }

  .fadein {
    opacity: 0;
    width: 100%;
    animation: fadein 1s forwards linear;
    animation-iteration-count: 1;
  }
  .fadein:nth-child(1) {
    animation-delay: 0.1s;
  }
  .fadein:nth-child(2) {
    animation-delay: 0.2s;
  }
  .fadein:nth-child(3) {
    animation-delay: 0.3s;
  }
  .fadein:nth-child(4) {
    animation-delay: 0.4s;
  }
  .fadein:nth-child(5) {
    animation-delay: 0.5s;
  }
  .fadein:nth-child(6) {
    animation-delay: 0.6s;
  }
  .fadein:nth-child(7) {
    animation-delay: 0.7s;
  }
  .fadein:nth-child(8) {
    animation-delay: 0.8s;
  }
  .fadein:nth-child(9) {
    animation-delay: 0.9s;
  }
  .fadein:nth-child(10) {
    animation-delay: 1s;
  }
  .fadein:nth-child(11) {
    animation-delay: 1.1s;
  }
  .fadein:nth-child(12) {
    animation-delay: 1.2s;
  }
  .fadein:nth-child(13) {
    animation-delay: 1.3s;
  }

  .moreButton {
    text-align: center;
  }

  .suggestion {
    position: relative;
    max-width: 480px;
    height: 432px;
    padding: 1.6rem;
    margin: 0 auto;
    transform: translateY();
  }

  .suggestion-image {
    position: absolute;
    right: 0;
    width: 380px;
    height: 432px;
    background-image: url(../assets/refreshing2.webp);
    background-repeat: no-repeat;
    background-size: cover;
    background-position: 20%;
    border-radius: 16px;
    /* filter: blur(1px); */
    transform: translateY(20px);
    transition: 1s;
    opacity: 0;
  }
  .text-wrapper {
    position: absolute;
    top: 7%;
    left: 0%;
    opacity: 0;
    transform: translateY(20px);
    transition: 1s;
  }

  .suggestion p {
    font-size: 2rem;
    line-height: 175%;
    padding-inline-start: 1.6rem;
  }

  @media screen and (500px <= width) {
    .suggestion p {
    font-size: 2.4rem;
  }

  }

  .highlight {
    color: var(--highlight);
  }

  .primary {
    color: var(--primary);
    font-weight: bold;
    padding-block: 0 1.6rem;
  }

  .cause {
    text-align: center;
    max-width: 1024px;
    margin: 40px auto 0 auto;
    padding-block: 2.4rem;
  }

  .cause-image {
    max-width: 1024px;
    background-repeat: no-repeat;
    background-size: cover;
    background-position: 50% 75%;
    aspect-ratio: 375/128;
    /* 画面幅が900pxを超えたらより細くする必要あり */
    opacity: 0;
    transition: 1s;
  }

  .yawning {
    background-image: url(../assets/yawning.webp);
  }

  .stiff_neck {
    background-image: url(../assets/stiff_neck.webp);
    background-position: center;
  }

  .cause p {
    letter-spacing: 3px;
  }

  .fadeinText {
    opacity: 0;
    transition: 1s;
    filter:drop-shadow(1px 2px 8px rgba(0, 0, 0, 0.371))
  }

  .fadeinText.highlight {
    filter:drop-shadow(1px 2px 8px rgb(246, 187, 98, 0.6));
    letter-spacing: 3px;
  }

  .text-1 {
    font-size: 2rem;
    font-weight: bold;
  }
  .cause .text-1,
  .cause .text-2 {
    padding-block-start: 0;
  }

  .text-2 {
    font-size: 1.8rem;
  }

  .bold {
    font-weight: bold;
  }
  .large {
    font-size: 2.4rem;
  }

  .icon {
    margin: 0 auto;
    width: 24px;
    height: 24px;
    background-image: url(/arrow-down.svg);
    background-repeat: no-repeat;
    background-size: contain;
  }

  .text-8 {
    margin-block: 1.6rem;
    font-size: 2rem;
    font-weight: bold;
  }

  .otherwise {
    text-align: center;
    font-family: 'Noto Sans JP', sans-serif;
    font-weight: bold;
    font-size: 2.2rem;
  }

</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    class ScrollObserver {
      constructor(els, cb, options) {
        //監視対象のelementsを取得
        this.els = document.querySelectorAll(els);
        //オプションのデフォルト設定を定義
        const defaultOptions = {
          root: null,
          rootMargin: "0px",
          threshold: 0,
        };
        this.cb = cb;
        //デフォルト設定に、個別設定のオプションをマージする
        this.options = Object.assign(defaultOptions, options);
        //
        this._init();
      }
      _init() {
        const callback = (entries) => {
          entries.forEach((entry) => {
            //監視対象の要素が領域内に入った場合の処理
            if (entry.isIntersecting) {
              this.cb(entry.target, true); //true=isIntersectingがtrue
              //処理後に監視を切る処理
              observer.unobserve(entry.target);
            }
            // else {
            //   this.cb(entry.target, false);
            // }
          });
        };
        const observer = new IntersectionObserver(callback.bind(this), this.options);
        //対象の要素elを監視
        this.els.forEach(el => observer.observe(el));
      }
    }

    //Problemパート
    const cb1 = function (el, isIntersecting) {
      if (isIntersecting) {
        //監視対象elとアニメーション対象が異なるため,elを使わずに要素を個別に取得
        const lists = [...document.querySelectorAll(".list")];
        const problemsImage = document.querySelector(".problems-image");
        lists.map((list) => {
          list.classList.add("fadein");
        });
        problemsImage.style.opacity = 0.6;
      }
    };
    //ScrollObserverの初期化(第1引数"entry.target",第2引数コールバック関数、第3引数オプションの個別設定)
    const problems = new ScrollObserver(".problems", cb1, {
      rootMargin: "-50px 0px",
      threshold: 0.5,
    });

    //Suggestionパート
    const cb2 = function (el, isIntersecting) {
      if (isIntersecting) {
        const suggestionImage = document.querySelector(".suggestion-image");
        const textWrapper = document.querySelector(".text-wrapper");
        suggestionImage.style.opacity = 0.6;
        suggestionImage.style.transform = "translateY(-20px)";
        textWrapper.style.opacity = 1;
        textWrapper.style.transform = "translateY(-20px)";
      }
    };
    const suggestion = new ScrollObserver(".suggestion", cb2, {
      rootMargin: "-50px 0px",
      threshold: 0.5,
    });


    //Causeパート
    const causeImg = function (el, isIntersecting) {
      if (isIntersecting) {
        //監視対象=アニメーション対象なのでelを使用
        el.style.opacity = 0.6;
      }
    };
    const causeImage = new ScrollObserver(".cause-image", causeImg, {
      threshold: 1,
    });

    const textFading = function (el, isIntersecting) {
      if (isIntersecting) {
        el.style.opacity = 1;
      }
    };
    const fadeinText = new ScrollObserver(".fadeinText",  textFading, {
      rootMargin: '-30% 0px',
      threshold: 0,
    });
  });
</script>
