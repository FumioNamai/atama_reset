---
import Layout from "@layouts/layout.astro";

const PUBLIC_KEY = import.meta.env.PUBLIC_KEY;
const EMAIL_SERVICE_ID = import.meta.env.PUBLIC_EMAIL_SERVICE_ID;
const EMAIL_TEMPLATE_ID = import.meta.env.PUBLIC_EMAIL_TEMPLATE_ID;

---

<Layout title="ご予約・お問い合わせ">
  <main>
    <astro-contact
      data-PUBLIC_KEY = {PUBLIC_KEY}
      data-EMAIL_SERVICE_ID = {EMAIL_SERVICE_ID}
      data-EMAIL_TEMPLATE_ID = {EMAIL_TEMPLATE_ID}
    >
    <section class ="contact">

      <form id="contact-form">
        <input type="hidden" name="contact_number">
        <label>Name</label>
        <input type="text" name="user_name">
        <label>Email</label>
        <input type="email" name="user_email">
        <label>Message</label>
        <textarea name="message"></textarea>
        <input type="submit" value="Send">
      </form>

    </section>
    </astro-contact>
  </main>
</Layout>

<style>
  main {
    margin-top: 40px;
  }
</style>


<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

<script type="text/javascript">
class AstroContact extends HTMLElement {
  constructor() {
    super();
    const PUBLIC_KEY = this.dataset.public_key;
    const EMAIL_SERVICE_ID = this.dataset.email_service_id;
    const EMAIL_TEMPLATE_ID = this.dataset.email_template_id;
      (function() {
          // https://dashboard.emailjs.com/admin/account
          emailjs.init(PUBLIC_KEY);
      })();
      window.onload = function () {
        document.getElementById("contact-form")
          .addEventListener("submit", function (event) {
            event.preventDefault();
            // generate a five digit number for the contact_number variable
            this.contact_number.value = (Math.random() * 100000) | 0;
            // these IDs from the previous steps
            emailjs.sendForm(EMAIL_SERVICE_ID, EMAIL_TEMPLATE_ID, this).then(
              function () {
                console.log("SUCCESS!");
              },
              function (error) {
                console.log("FAILED...", error);
              }
            );
          });
      };
  }
}
customElements.define('astro-contact', AstroContact);
</script>
