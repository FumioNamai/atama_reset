---
import Layout from "@layouts/layout.astro";

const PUBLIC_KEY = import.meta.env.PUBLIC_KEY;
const EMAIL_SERVICE_ID = import.meta.env.PUBLIC_EMAIL_SERVICE_ID;
const EMAIL_TEMPLATE_ID = import.meta.env.PUBLIC_EMAIL_TEMPLATE_ID;

---

<Layout title="ご予約・お問い合わせ">
  <main>
    <astro-contact
      data-PUBLIC_KEY = {PUBLIC_KEY}
      data-EMAIL_SERVICE_ID = {EMAIL_SERVICE_ID}
      data-EMAIL_TEMPLATE_ID = {EMAIL_TEMPLATE_ID}
    >
    <section class ="contact">
      <h2>ご予約・お問い合わせ</h2>
      <div class="intro">
        <p>当店は<span class="bold">完全ご予約制</span>でございます</p>
        <p><span class="bold">前日までに、</span>ご希望の日時とコースをお知らせください。</p>
        <p>初めてのお客様は、「<a href="/first_time">初めてのお客様へ</a>」「<a href="/first_time#taboo">施術の禁忌</a>」を必ずお読みください。</p>
      </div>
      <div class="fromWeb">
        <h3>WEBからのご予約・お問い合わせ</h3>
        <form id="contact-form">
          <input type="hidden" name="contact_number">

          <div>
            <label>Name</label><input type="text" name="user_name">
          </div>
          <div>
          <label>Email</label><input type="email" name="user_email">
          </div>
          <div>
          <label>Message</label>
          <textarea name="message"></textarea>
        </div>
          <input type="submit" value="Send">
        </form>

      </div>

      <div class="fromMail">
        <h3>メールでのご予約・お問い合わせ</h3>
        <a href="mailto:atama.reset@gmail.com">atama.reset@gmail.com</a>
      </div>

      <div class="fromPhone">
        <h3>お電話でのご予約・お問い合わせ</h3>
        <a href="tel:080-9271-7855">080-9271-7855</a>
      </div>




    </section>
    </astro-contact>
  </main>
</Layout>

<style>
  main {
    margin-top: 40px;
  }
</style>


<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

<script type="text/javascript">
class AstroContact extends HTMLElement {
  constructor() {
    super();
    const PUBLIC_KEY = this.dataset.public_key;
    const EMAIL_SERVICE_ID = this.dataset.email_service_id;
    const EMAIL_TEMPLATE_ID = this.dataset.email_template_id;
      (function() {
          // https://dashboard.emailjs.com/admin/account
          emailjs.init(PUBLIC_KEY);
      })();
      window.onload = function () {
        document.getElementById("contact-form")
          .addEventListener("submit", function (event) {
            event.preventDefault();
            // generate a five digit number for the contact_number variable
            this.contact_number.value = (Math.random() * 100000) | 0;
            // these IDs from the previous steps
            emailjs.sendForm(EMAIL_SERVICE_ID, EMAIL_TEMPLATE_ID, this).then(
              function () {
                console.log("SUCCESS!");
              },
              function (error) {
                console.log("FAILED...", error);
              }
            );
          });
      };
  }
}
customElements.define('astro-contact', AstroContact);
</script>
