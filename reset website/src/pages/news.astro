---
import Layout from "@layouts/layout.astro";

import { getNews } from "src/library/news";

const posts = await getNews({ limit: 100 });
// console.log(posts);

const data = posts.contents.map((content) => ({
  title: content.title,
  publishedAt: content.publishedAt
    ? new Date(content.publishedAt)
        .toLocaleDateString("ja-JP")
        .split("/")
        .join(".")
    : "",
  articles:content.article
}));

---

<Layout title="お知らせ">
  <main>
    <section>
      <h2>お知らせ</h2>
      {
        data.map((content) => (
          <div class="container">
            <p class="publishedAt">{content.publishedAt}</p>
            <h3 class="title">{content.title}</h3>
            <article>
              {
                content.articles.map((article) => {
                  switch (article.fieldId) {
                    case "rich_editor":
                      return <div class="setHtml richText richEditor" set:html={article.rich_editor} />;
                    case "image":
                      return (
                        <div class="image richEditor">
                          <img
                            src={article.image.url}
                            alt=""
                            height={article.image.height}
                            width={article.image.width}
                          />
                        </div>
                      );
                    case "text":
                      return <p class="richEditor">{article.text}</p>;
                    default:
                      break;
                  }
                })
              }
            </article>
            </div>
            ))
      }
    </section>
  </main>
</Layout>

<style>
  section {
    text-align: center;
    max-width: 680px;
    margin: 0 auto;
    padding-block: 4rem;
    padding-inline: 1.6rem;
  }

  h2 {
    margin-block-end: 2.4rem;
  }
  .container {
    text-align: start;
    padding-block: 2.4rem 0;
    border-bottom: 1px solid var(--gray-25);
  }

  .publishedAt {
    padding: 0;
    font-size: 1.4rem;
  }

  .title {
    margin-block-end: 2.4rem;
  }

  .richEditor {
    margin-block-end: 2.4rem;
  }
</style>

<style is:global>
  .setHtml p {
    line-height: 3rem;
    padding-bottom: 4rem;
  }
</style>
